class UsersController < ApplicationController
  register Sinatra::ActiveRecordExtension
  set :views, Proc.new { File.join(root, "../views/") }

  get '/login' do

    if !!session["user_id"]
      redirect to '/'
    end

    @error = ""
    erb :'users/login'
  end

  post '/login' do
    stuff = User.find_by(username: params[:username])
    if !!stuff == false
      @error = "Username not recognized"
      erb :'users/login'
    elsif stuff.authenticate(params[:password]) == false
      @error = "Valid username, incorrect password"
      erb :'users/login'
    else
      session[:user_id] = stuff.id
      redirect to '/'
    end
  end

  get '/logout' do
    if !!session["user_id"]
      erb :'users/logout'
    else

      redirect to '/'

      erb :'index'

    end
  end

  post '/logout' do

    if !!session["user_id"]
      session.clear
      redirect to '/'
    else
      redirect to '/'
    end
  end

  get '/signup' do

    @error = ""
    erb :'users/create_user'
  end

  post '/signup' do
	@error = ""
    if User.find_by(username: params[:username]) != nil
      @error += "Username already in use"
	  puts "fuck this route too"
	  redirect to '/signup'
    end
    if @error != ""
	  puts "fuck this route"
      redirect to '/signup'
    else
      dude = User.create(username: params[:username], password: params[:password])
      session[:user_id] = dude.id
	  puts "especially fuck this route"
      redirect to '/'
    end
  end

  get '/users/:user_id' do
    @user = User.find_by(id: params[:user_id])
    erb :'users/show'
  end
end